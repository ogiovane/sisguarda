"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[311],{311:(T,m,i)=>{i.r(m),i.d(m,{CautelarMaterialComponent:()=>M});var d=i(5861),o=i(95),_=i(4664),g=i(2096),f=i(5592),v=i(7398),c=i(6814),e=i(9212),h=i(5835),p=i(5076);function C(n,Z){if(1&n&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&n){const t=Z.$implicit;e.Q6J("value",t.id),e.xp6(),e.Oqu(t.descricaoMaterial)}}let M=(()=>{class n{constructor(t,a,r,s){this.firestore=t,this.fb=a,this.route=r,this.router=s,this.materiaisDisponiveis=[],this.emprestimoForm=new o.cw({nf:new o.NI("",o.kI.required),rg:new o.NI({value:"",disabled:!0},o.kI.required),nome:new o.NI({value:"",disabled:!0},o.kI.required),posto:new o.NI({value:"",disabled:!0},o.kI.required),tipo:new o.NI("",o.kI.required),materialId:new o.NI("",o.kI.required),descricaoMaterial:new o.NI("",o.kI.required),status:new o.NI("",o.kI.required)});const l=this.router.getCurrentNavigation();if(l?.extras.state){const u=l.extras.state.material;this.emprestimoForm.patchValue({tipo:u.tipo,descricaoMaterial:u.descricaoMaterial,materialId:u.id,status:"Dispon\xedvel"})}}ngOnInit(){this.emprestimoForm.get("tipo")?.valueChanges.pipe((0,_.w)(t=>t?this.firestore.collection("materiais",a=>a.where("status","==","Dispon\xedvel").where("tipo","==",t)).valueChanges({idField:"id"}):(0,g.of)([]))).subscribe(t=>{this.materiaisDisponiveis=t})}carregarMateriaisPorTipo(){let t=this.emprestimoForm.get("tipo")?.value;this.materiaisDisponiveis$=t?this.firestore.collection("materiais",a=>a.where("status","==","Dispon\xedvel").where("tipo","==",t)).valueChanges({idField:"id"}):new f.y}validarMilitar(){const t=this.emprestimoForm.get("nf")?.value;this.firestore.collection("cadastros",a=>a.where("nf","==",t)).valueChanges({idField:"id"}).pipe((0,v.U)(a=>a[0])).subscribe(a=>{a?this.emprestimoForm.patchValue({rg:a.rg,nome:a.nome,posto:a.posto}):alert("Militar n\xe3o encontrado.")})}adicionarAoHistorico(t){const a={...t,dataHora:t.dataHora.toISOString()};this.firestore.collection("historico").add(a).then(()=>console.log("Registro adicionado ao hist\xf3rico com sucesso.")).catch(r=>console.error("Erro ao adicionar registro ao hist\xf3rico:",r))}atualizarDescricaoMaterial(t){const a=t.target.value,r=this.materiaisDisponiveis.find(s=>s.id===a);this.emprestimoForm.patchValue({descricaoMaterial:r?.descricaoMaterial||""})}salvarEmprestimo(){if(this.emprestimoForm.valid){const t=this.emprestimoForm.getRawValue();t.dataHoraCautela=new Date,t.responsavelCautela="",t.dataHoraDevolucao="",t.responsavelDevolucao="",this.firestore.collection("historico").add(t).then(a=>{console.log("Emprestimo registrado com sucesso:",a.id),this.atualizarStatusMaterial(t.materialId,"Cautelado").then(()=>{confirm("Deseja continuar realizando cautelas?")?(this.emprestimoForm.controls.tipo.updateValueAndValidity(),this.emprestimoForm.controls.materialId.reset(),this.emprestimoForm.controls.descricaoMaterial.reset(),this.emprestimoForm.controls.status.reset(),this.carregarMateriaisPorTipo()):this.router.navigate(["/listar-materiais"])})}).catch(a=>{console.error("Erro ao salvar empr\xe9stimo:",a)})}else alert("Por favor, preencha todos os campos obrigat\xf3rios.")}atualizarStatusMaterial(t,a){var r=this;return(0,d.Z)(function*(){return r.firestore.collection("materiais").doc(t).update({status:a})})()}cancelarEmprestimo(){this.emprestimoForm.reset()}voltar(){this.router.navigate(["/listar-materiais"])}static#e=this.\u0275fac=function(a){return new(a||n)(e.Y36(h.ST),e.Y36(o.qu),e.Y36(p.gz),e.Y36(p.F0))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-cautelar-material"]],standalone:!0,features:[e.jDz],decls:58,vars:3,consts:[[1,"container","mt-4"],[3,"formGroup","ngSubmit"],[1,"mb-3"],["for","nf",1,"form-label"],["type","text","id","nf","formControlName","nf",1,"form-control",3,"keyup.enter"],["type","button",1,"btn","btn-primary","mt-2",3,"click"],["for","rg",1,"form-label"],["type","text","id","rg","formControlName","rg","readonly","",1,"form-control"],["for","nome",1,"form-label"],["type","text","id","nome","formControlName","nome","readonly","",1,"form-control"],["for","posto",1,"form-label"],["type","text","id","posto","formControlName","posto","readonly","",1,"form-control"],["for","tipo",1,"form-label"],["id","tipo","formControlName","tipo",1,"form-select",3,"change"],["value",""],["value","Chave"],["value","Cart\xe3o"],["value","Documento"],["value","Outros"],["for","descricaoMaterial"],["id","descricaoMaterial","formControlName","materialId",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","status",1,"form-label"],["id","status","formControlName","status",1,"form-select"],["value","Dispon\xedvel"],["value","Cautelado"],["value","Emprestado"],["value","Com a Subse\xe7\xe3o de Transportes"],[1,"text-center"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"]],template:function(a,r){1&a&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return r.salvarEmprestimo()}),e.TgZ(2,"div",2)(3,"label",3),e._uU(4,"NF Militar"),e.qZA(),e.TgZ(5,"input",4),e.NdJ("keyup.enter",function(){return r.validarMilitar()}),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return r.validarMilitar()}),e._uU(7,"Validar"),e.qZA()(),e.TgZ(8,"div",2)(9,"label",6),e._uU(10,"RG"),e.qZA(),e._UZ(11,"input",7),e.qZA(),e.TgZ(12,"div",2)(13,"label",8),e._uU(14,"Nome Completo"),e.qZA(),e._UZ(15,"input",9),e.qZA(),e.TgZ(16,"div",2)(17,"label",10),e._uU(18,"Posto"),e.qZA(),e._UZ(19,"input",11),e.qZA(),e.TgZ(20,"div",2)(21,"label",12),e._uU(22,"Tipo de Material"),e.qZA(),e.TgZ(23,"select",13),e.NdJ("change",function(){return r.carregarMateriaisPorTipo()}),e.TgZ(24,"option",14),e._uU(25,"Selecione um tipo"),e.qZA(),e.TgZ(26,"option",15),e._uU(27,"Chave"),e.qZA(),e.TgZ(28,"option",16),e._uU(29,"Cart\xe3o"),e.qZA(),e.TgZ(30,"option",17),e._uU(31,"Documento"),e.qZA(),e.TgZ(32,"option",18),e._uU(33,"Outros"),e.qZA()()(),e.TgZ(34,"div",2)(35,"label",19),e._uU(36,"Material"),e.qZA(),e.TgZ(37,"select",20),e.NdJ("change",function(l){return r.atualizarDescricaoMaterial(l)}),e.TgZ(38,"option",14),e._uU(39,"Selecione..."),e.qZA(),e.YNc(40,C,2,2,"option",21),e.qZA()(),e.TgZ(41,"div",2)(42,"label",22),e._uU(43,"Status"),e.qZA(),e.TgZ(44,"select",23)(45,"option",24),e._uU(46,"Dispon\xedvel"),e.qZA(),e.TgZ(47,"option",25),e._uU(48,"Cautelado"),e.qZA(),e.TgZ(49,"option",26),e._uU(50,"Emprestado"),e.qZA(),e.TgZ(51,"option",27),e._uU(52,"Com a Subse\xe7\xe3o de Transportes"),e.qZA()()(),e.TgZ(53,"div",28)(54,"button",29),e._uU(55,"Salvar"),e.qZA(),e.TgZ(56,"button",30),e.NdJ("click",function(){return r.cancelarEmprestimo()}),e._uU(57,"Cancelar"),e.qZA()()()()),2&a&&(e.xp6(),e.Q6J("formGroup",r.emprestimoForm),e.xp6(39),e.Q6J("ngForOf",r.materiaisDisponiveis),e.xp6(14),e.Q6J("disabled",r.emprestimoForm.invalid))},dependencies:[o.UX,o._Y,o.YN,o.Kr,o.Fj,o.EJ,o.JJ,o.JL,o.sg,o.u,c.ez,c.sg],styles:['@charset "UTF-8";.custom-dialog-container[_ngcontent-%COMP%]{z-index:1500}.mat-dialog-container[_ngcontent-%COMP%]{transform:translate(0)!important;transform:translateY(0)!important}']})}return n})()}}]);