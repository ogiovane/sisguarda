"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[898],{5898:(g,c,s)=>{s.r(c),s.d(c,{DevolverMaterialComponent:()=>h});var t=s(95),u=s(6814),m=s(1374),e=s(9212),v=s(5835),_=s(5076);function d(r,A){1&r&&(e.TgZ(0,"div",5)(1,"label",12),e._uU(2,"N\xfamero do Cupom de Abastecimento:"),e.qZA(),e._UZ(3,"input",13),e.qZA())}function f(r,A){if(1&r&&(e.TgZ(0,"div")(1,"div",5)(2,"label",6),e._uU(3,"Necessita Abastecimento?"),e.qZA(),e.TgZ(4,"select",7)(5,"option",8),e._uU(6,"Selecione"),e.qZA(),e.TgZ(7,"option",9),e._uU(8,"Sim"),e.qZA(),e.TgZ(9,"option",10),e._uU(10,"N\xe3o"),e.qZA()()(),e.YNc(11,d,4,0,"div",11),e.qZA()),2&r){const o=e.oxw();e.xp6(11),e.Q6J("ngIf","sim"===o.devolucaoForm.get("necessitaAbastecimento").value)}}let h=(()=>{class r{constructor(o,i,a){this.fb=o,this.firestore=i,this.router=a,this.devolucaoForm=this.fb.group({necessitaAbastecimento:["",t.kI.required],cupomAbastecimento:["",t.kI.pattern("[0-9]*")]})}ngOnInit(){this.material=history.state.material,this.devolucaoForm.get("necessitaAbastecimento").valueChanges.subscribe(o=>{"sim"===o?this.devolucaoForm.get("cupomAbastecimento").enable():this.devolucaoForm.get("cupomAbastecimento").disable()})}confirmarDevolucao(){const i={status:"Dispon\xedvel",dataHoraDevolucao:new Date,...this.material.posto&&{posto:this.material.posto},...this.material.nome&&{nome:this.material.nome},..."sim"===this.devolucaoForm.value.necessitaAbastecimento&&{cupomAbastecimento:this.devolucaoForm.value.cupomAbastecimento}},a=this.firestore.collection("historico").doc(this.material.id).update(i),l=this.firestore.collection("materiais",n=>n.where("descricaoMaterial","==",this.material.descricaoMaterial)).get().pipe((0,m.P)()).toPromise().then(n=>{const p=[];return n.forEach(b=>{p.push(b.ref.update({status:"Dispon\xedvel"}))}),Promise.all(p)});Promise.all([a,l]).then(()=>{this.router.navigate(["/materiais-cautelados"])}).catch(n=>{console.error("Erro ao atualizar documentos:",n)})}atualizarStatusMaterial(){this.firestore.collection("materiais",o=>o.where("descricaoMaterial","==",this.material.descricaoMaterial)).get().pipe((0,m.P)()).subscribe(o=>{o.forEach(i=>{i.ref.update({status:"Dispon\xedvel"}).then(()=>console.log("Status atualizado com sucesso em 'materiais'")).catch(a=>console.error("Erro ao atualizar status em 'materiais':",a))})})}cancelar(){this.router.navigate(["/materiais-cautelados"])}static#e=this.\u0275fac=function(i){return new(i||r)(e.Y36(t.qu),e.Y36(v.ST),e.Y36(_.F0))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["app-devolver-material"]],standalone:!0,features:[e.jDz],decls:17,vars:4,consts:[[1,"container","mt-4"],[3,"formGroup"],[4,"ngIf"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"mb-3"],["for","necessitaAbastecimento",1,"form-label"],["id","necessitaAbastecimento","formControlName","necessitaAbastecimento",1,"form-select"],["value","","disabled",""],["value","sim"],["value","nao"],["class","mb-3",4,"ngIf"],["for","cupomAbastecimento",1,"form-label"],["type","text","id","cupomAbastecimento","formControlName","cupomAbastecimento",1,"form-control"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"h2"),e._uU(2,"Devolver Material"),e.qZA(),e.TgZ(3,"p")(4,"strong"),e._uU(5,"Tipo:"),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"p")(8,"strong"),e._uU(9,"Descri\xe7\xe3o:"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"form",1),e.YNc(12,f,12,1,"div",2),e.TgZ(13,"button",3),e.NdJ("click",function(){return a.confirmarDevolucao()}),e._uU(14,"Confirmar"),e.qZA(),e.TgZ(15,"button",4),e.NdJ("click",function(){return a.cancelar()}),e._uU(16,"Cancelar"),e.qZA()()()),2&i&&(e.xp6(6),e.hij(" ",a.material.tipo,""),e.xp6(4),e.hij(" ",null==a.material?null:a.material.descricaoMaterial,""),e.xp6(),e.Q6J("formGroup",a.devolucaoForm),e.xp6(),e.Q6J("ngIf","Cart\xe3o"===a.material.tipo))},dependencies:[u.ez,u.O5,t.UX,t._Y,t.YN,t.Kr,t.Fj,t.EJ,t.JJ,t.JL,t.sg,t.u],encapsulation:2})}return r})()}}]);